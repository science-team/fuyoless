<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="./global.css" />
        <title>The Fuyoless Counter</title>
    </head>
    <body>
        <div class="flex h-screen">
            <div class="w-screen">
                <div class="bg-gray-200 py-2 px-4 font-bold">Fuyoless Counter</div>
                <div class="p-4">
                    <div class="text-xl font-bold">
                        <img
                            src="./assets/images/science-team.jpg"
                            alt="science-team"
                            class="w-8 h-8 inline"
                        />
                        What is this page?
                    </div>
                    <p>
                        This is a formulated page to calculate how much time have passed since the
                        last time we are away from
                        <span class="text-green-500">la cosa verde</span>
                        <span class="text-orange-600 font-bold">Fuyo Cloverfield</span>
                    </p>
                </div>
                <div class="p-4 font-bold">
                    <img
                        id="fuyo-waiting"
                        src="./assets/images/fuy_eh.png"
                        alt="fuyo-image"
                        class="w-16 h-16"
                    />
                    <img
                        id="fuyo-cry"
                        src="./assets/images/fuy_uwoo.png"
                        alt="fuyo-cry"
                        class="w-16 h-16 hidden"
                    />
                    <img
                        id="fuyo-happy"
                        src="./assets/images/fuy_yee.png"
                        alt="fuyo-happy"
                        class="w-16 h-16 hidden"
                    />
                    <div id="fuyoless">Calculating your time without Fuyo...</div>
                    <div id="livestream" class="hidden">
                        LIVE : <a class="text-red-500" href="#"></a>
                    </div>
                </div>
            </div>
        </div>

        <script>
            const fuyoless = document.querySelector('#fuyoless');
            const livestream = document.querySelector('#livestream');
            function calculateDiffs(time) {
                const now = new Date();
                const diffTime = Math.abs(now - time);
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                const diffHours = Math.floor((diffTime % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const diffMinutes = Math.floor((diffTime % (1000 * 60 * 60)) / (1000 * 60));
                const diffSeconds = Math.floor((diffTime % (1000 * 60)) / 1000);
                return `${diffDays} days, ${diffHours} hours, ${diffMinutes} minutes, ${diffSeconds} seconds`;
            }
            async function chubaless(channelID = 'UC8zgKaS8LiyL28mdhRC2nBg') {
                const liveData = await fetch(
                    `https://holodex.net/api/v2/live?channel_id=${channelID}&limit=1&status=live`
                ).then((res) => res.json());
                if (liveData.length) {
                    const [{ id, title }] = liveData;
                    const ytlink = `https://youtube.com/live/${id}`;

                    document.querySelector('#fuyo-waiting').classList.toggle('hidden');
                    document.querySelector('#fuyo-happy').classList.toggle('hidden');
                    fuyoless.innerText = 'Fuyo is LIVE! Fuyoless is no more!';
                    const link = livestream.querySelector('a');
                    link.href = ytlink;
                    link.innerText = title;

                    livestream.classList.toggle('hidden');
                    return;
                }
                const lastStreamData = await fetch(
                    `https://holodex.net/api/v2/videos?channel_id=${channelID}&status=past&limit=1&type=stream`
                ).then((res) => res.json());
                const [{ available_at, duration }] = lastStreamData;
                const stream_start = new Date(available_at);
                const stream_end = new Date(stream_start.getTime() + duration * 1000);
                let changed = false;
                setInterval(() => {
                    const result = calculateDiffs(stream_end);
                    if (!changed) {
                        changed = true;
                        document.querySelector('#fuyo-waiting').classList.toggle('hidden');
                        document.querySelector('#fuyo-cry').classList.toggle('hidden');
                    }
                    fuyoless.innerHTML = `We have been <span class="text-red-600">Fuyoless</span> for : <br /> ${result}`;
                }, 1000);
            }
            chubaless();
        </script>
    </body>
</html>
